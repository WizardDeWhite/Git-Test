1. General helpers
================================================================================

1.1 allocation/deallocation from vm_area_cachep(kmem_cache)
================================================================================
vm_area_alloc/vm_area_dup
vm_area_free

1.2 find_vma_links(), get the location to insert
================================================================================
after a successful search, it returns
  * prev, the prev vma
  * rb_link, exact pointer to put vma
  * rb_parent, vma's parent

2.2 vma_link(), insert a vma
================================================================================
need to rely on other helper like find_vma_links() to get the location

2.2.1 __vma_link()
================================================================================

2.2.1.1 __vma_link_list(), link to ordered list
================================================================================

2.2.1.2 __vma_link_rb(), link to rb tree (vm_mm->mm_rb)
================================================================================

2.2.2 __vma_link_file()
================================================================================

2.3 vma_rb_erase()
================================================================================

2.3.1 __vma_rb_erase()
================================================================================

2.4 remove_vma()
================================================================================

2.4.1 vm_area_free()
================================================================================

2.5 split_vma()
================================================================================

2.5.1 __split_vma()
================================================================================

2.5.1.1 vm_area_dup()
================================================================================

2.5.1.2 anon_vma_clone(), reverse mapping
================================================================================

2.5.1.3 vma_adjust()
================================================================================

2.6 vma_adjust()
================================================================================

2.6.1 __vma_adjust()
================================================================================

2.6.1.1 vma_adjust_trans_huge()
================================================================================

3. do_munmap()
================================================================================
unmap range [start, start + len]

3.1 find_vma()
================================================================================

3.2 __split_vma()
================================================================================

3.3 detach_vmas_to_be_unmapped()
================================================================================

3.4 unmap_region()
================================================================================

3.4.1 lru_add_drain()
================================================================================

3.4.2 tlb_gather_mmu()
================================================================================

3.4.3 update_hiwater_rss()
================================================================================

3.4.4 unmap_vmas()
================================================================================

3.4.4.1 unmap_single_vma()
================================================================================

3.4.5 free_pgtables()
================================================================================

3.4.5.1 free_pgd_range()
================================================================================

3.4.6 tlb_finish_mmu()
================================================================================

3.5 arch_unmap()
================================================================================

3.6 remove_vma_list()
================================================================================

3.6.1 update_hiwater_vm()
================================================================================

3.6.2 vm_stat_account()
================================================================================

3.6.3 remove_vma()
================================================================================

3.6.4 vm_unacct_memory()
================================================================================

0. data structure
================================================================================

0.1 mm_struct
================================================================================

    mm_struct
    +--------------------------------+
    |pgd                             |
    |    (pgd_t *)                   |
    |                                |
    +--------------------------------+
    |map_count                       |    num of vmas
    |    (int)                       |
    |mm_rb                           |
    |    (struct rb_root)            |
    |mmap                            |
    |    (struct vm_area_struct*)    |
    |                                |
    +--------------------------------+
    |cpu_bitmap[]                    |
    |    (unsigned long)             |
    |tlb_flush_pending               |
    |    (atomic_t)                  |
    +--------------------------------+
    |start_code, end_code            |
    |start_data, end_data            |
    |start_brk, brk                  |    http://t.cn/RnaZRUv
    |start_stack                     |
    |                                |
    |highest_vm_end                  |    last vma end address
    |    (unsigned long)             |
    |                                |
    +--------------------------------+
    |rss_stat                        |
    |    (struct mm_rss_stat)        |
    |    +---------------------------+
    |    |count[NR_MM_COUNTERS]      | MM_FILEPAGES/ANONPAGES/SWAPENTS/SHMEMPAGES
    |    |    (atomic_long_t)        |
    |    +---------------------------+
    |                                |
    |                                |
    |                                |
    |                                |
    |                                |
    +--------------------------------+

0.2 vm_area_struct
================================================================================

    vm_area_struct
    +--------------------------------+
    |vm_mm                           |    the mm we belongs to
    |   (struct mm_struct *)         |
    +--------------------------------+
    |vm_rb                           |    vma rb tree node
    |   (struct rb_node)             |
    |vm_prev, vm_next                |    vma list in order
    |   (struct vm_area_struct*)     |    * no overlap to each other
    |                                |
    +--------------------------------+
    |vm_start, vm_end                |    the range we cover
    |   (unsigned long)              |
    |                                |
    |vm_pgoff                        |    offset in PAGE_SIZE
    |   (unsigned long)              |
    +--------------------------------+
    |rb_subtree_gap                  |    http://tinylab.org/rbtree-part1/
    |   (unsigned long)              |
    +--------------------------------+
    |vm_flags                        |    VM_READ/WRITE/EXEC
    |   (unsigned long)              |
    |vm_page_prot                    |    access PTE permission of this VMA calculated from vm_flags
    |   (pgprot_t)                   |    _PAGE_PRESENT/RW/ACCESSED/DIRTY
    |                                |
    +--------------------------------+
    |vm_file                         |
    |   (struct file*)               |
    |                                |
    |                                |
    |shared                          |
    |   +----------------------------+
    |   |rb                          |
    |   |    (struct rb_node)        |
    |   |rb_subtree_last             |
    |   |    (unsigned long)         |
    +---+----------------------------+
    |                                |
    |                                |
    |                                |
    +--------------------------------+
    |vm_policy                       |
    |   (struct mempolicy *)         |
    +--------------------------------+
