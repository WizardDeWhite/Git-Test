内核编译是一个非常生僻的领域，哪怕是做内核的童鞋也不一定关注过整个内核编译的流程，更不用说内核的门外汉了。

然而了解学习内核编译系统，可能会有你意想不到的收获。我在这个过程中从以下几个方面获得收益。

* 深入的理解makefile如何管理大型项目
* 编译出错了也不会那么慌张
* 多年后才明白究竟是哪个文件才是放在/boot/目录下的那个启动文件以及它和另一个很像的文件之间的差别
* 节省了编译时间，不会每次都用make all这种粗暴的方式了
* 传说的make -j8中，这8个进程是在什么条件下才能开启的
* 进一步的了解了整个内核的构造，而不是仅仅知道自己做的那一块了
* 了解了某些编译链接细节，帮助看懂内核启动时的一些操作

但是很多人，包括我自己在很长的一段时间内都没有相对仔细阅读和研究内核编译的过程。在此，我希望通过分享自己一点点的经验，帮助大家破除对内核编译系统的抵触，快速掌握内核编译系统的整体架构，为后续的深入研究开一个好头。

鉴于本人经验尚浅，或有不透彻甚至是错误的地方，还望大家包涵。如能告知，万分感谢。

# 先用起来

大多数人都是从最简单的开始的，我也不例外。首先你得有这么一个环境，能够编译内核，接下来你才有机会去修改去实验去探索内核编译的过程。

第一步先

[编译出你的第一个内核][9]

由此小白们可以体会一下编译的过程，和使用自己编译的内核的快乐。也为后续我们做深入的实验做好准备。

在了解了基本的编译过程和步骤之后，我们再来看看那些

[内核编译中的小目标][10]。

这些小目标可以帮助我们

* 生成辅助资料
* 生成单个目标文件
* 节约时间
* 偶尔可以帮助一下调试

或许你会发现某个对你有用的～

# 跟着我走

现在我们已经会使用基本的命令制作出内核和一些小目标了。说实话，整个kbuild系统还是有点复杂的。不过不用担心，我们先来三个简单的小目标，了解一下基本的运作方式。或许你会觉得并没有想象中的那么高不可攀，或许可以让自己觉得还是有那么点机会可以看懂的～

先来一个最简单最直接的

[可能是kbuild中最直接的小目标 -- help][11]

看了这个例子，你或许会觉得不过瘾。什么嘛，这个help的目标就和平时自己写的makefile的套路是一样的。没有什么花头，也不是什么高级货。好了，这次我们来一个稍微复杂一些的。上面的例子太直接了只有一个层次的结构，那这次来一个有两层的看看。

[使用了一个kbuild函数的目标 -- cscope][13]

有了上述这两个不是编译目标的目标，我们已经储备了相当的make和kbuild知识，了解了一定的kbuild系统结构，接下来来看一个稍微复杂一点但相对还是比较直接的目标。这次可是货真价实的编译目标了哦～

[内核中单个.o文件的编译过程][12]

# 真刀真枪

能走到这，而且看懂上面三个小目标的基本上已经储备了足够多的基础知识。正所谓养兵千日，用兵一时，接下来我们就该动真格的了～

在根目录下最明显的内核目标就数vmlinux了。不过编译内核这么多年，安装内核无数次，却从来都没有好好研究过他老人家出生的过程。那我们就先来看看

[根目录vmlinux的编译过程][1]

研究完了根目录的vmlinux，我突然发现还有一个叫bzImage的目标。也是啊，内核不是说要压缩的么？vmlinux是ELF格式，那就能被直接加载到内存了？带着这些疑惑，让我们来探索一下

[启动镜像bzImage的前世今生][2]

探索的过程中发现bzImage是由setup.bin和vmlinux.bin两个目标粘合而成。看来马上就要弄明白整个bzImage编译过程了。咱逐个探索～

[setup.bin的诞生记][14]

和

[真假vmlinux--由vmlinux.bin揭开的秘密][3]

终于，经历了九九八十一难之后，可以说彻底的理解了内核编译的整个过程，也对kbuild系统架构有了基本的认识。可以学成下山了。

# 基本概念

温故而知新，在探索过程中我们是见招拆招，可能用到了不少概念，但没有系统梳理。现把相关知识点整理如下，以便有更好的理解。

[linux kernel makefile中的那些小伙伴们][5]
[常见内核目标都是在哪里？][6]

# 调试经验

丑是丑了点，不过凑和还能用。要是有更好的方法，记得告诉我哈～

[内核编译过程的调试小窍门][7]

# 写在最后

整个内核的编译系统依然是十分庞大复杂的。其中还有不少细枝末节在本系列中没有深入仔细地去分析，讲解和探索。经过了这么一段时间的磨练，相信大家已经掌握了基本的知识，对kbuild系统运作原理有了深入了了解，若能为大家进一步的探索打下了基础也算是没有白费功夫。

本系列文章或许还会再修正更新增加，本次更新就先到这里。愿大家能够在内核探索的道路上勇猛精进。

送君千里，终须一别，我们来日江湖再见～

[1]: http://blog.csdn.net/richardysteven/article/details/52502734
[2]: http://blog.csdn.net/richardysteven/article/details/52395737
[3]: http://blog.csdn.net/RichardYSteven/article/details/57973554
[4]: http://blog.csdn.net/richardysteven/article/details/52551443
[5]: http://blog.csdn.net/richardysteven/article/details/52420936
[6]: http://blog.csdn.net/richardysteven/article/details/52906049
[7]: http://blog.csdn.net/richardysteven/article/details/52908436
[8]: https://www.gnu.org/software/make/manual/make.html#Rule-Introduction
[9]: http://blog.csdn.net/RichardYSteven/article/details/56480485
[10]: http://blog.csdn.net/RichardYSteven/article/details/56482735
[11]: http://blog.csdn.net/RichardYSteven/article/details/56666283
[12]: http://blog.csdn.net/RichardYSteven/article/details/56666514
[13]: http://blog.csdn.net/RichardYSteven/article/details/56833038
[14]: http://blog.csdn.net/RichardYSteven/article/details/57958264